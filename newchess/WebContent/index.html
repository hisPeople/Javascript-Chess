<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
<script type="text/javascript"
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
<script type="text/javascript">
	var CELL_SIZE = 100;
	var X_CELLS = 8;
	var Y_CELLS = 8;
	var BOARD_WIDTH = CELL_SIZE * Y_CELLS + 1;
	var BOARD_HEIGHT = CELL_SIZE * X_CELLS + 1;
	var hasSelection = false;
	var brd = new board();
	var isSelected = false;
	var selectedLocation;
	$(document).ready(function() {
		drawBoard();
		brd.initialize();
		var whiteTeam = buildTeam("white");
		var darkTeam = buildTeam("black");
		brd.drawPieces();

		
		var from = new location(6,3);
		var to = new location(5,3);
		var testMove = new move(from,to);
		makeMoveTest(testMove);
		
		var moveArgs = {"from":{"row":6,"column":2},"to":{"row":4,"column":2}};
		var testMove2 = moveArgs;
		
		var from2 = new location(testMove2.from.row,testMove2.from.column);
		var to2 = new location (testMove2.to.row,testMove2.to.column); 
		var move3 = new move(from2,to2);
		makeMoveTest(move3);
		
		
		
		//getMoveFromServer(null);
		/* 	var whtpawn = new pawn("white");
		 drawPiece(whtpawn.getImage(),2,2);
		 var drkqueen = new queen("black");
		 drawPiece(drkqueen.getImage(),4,4); */

		$('#c').bind("click", function(e) {
			var x = Math.floor(e.pageX / 100);
			var y = Math.floor(e.pageY / 100);

			console.log('isSelected : ' + isSelected);

			if (!isSelected) {
				selectedLocation = new location(y, x);
			} else {
				movePiece(selectedLocation, new location(y, x));
			}

			isSelected = !isSelected;
		})

	});
	
	

	function getMoveFromServer(gameState){
		$.ajax({
			type: "POST",
			url: "chess.neumont.edu:8081/ChessGame/getmove",
			data : '{"movingTeamColor":"DARK","pieceDescriptions":[[{"teamColor":"LIGHT","hasMoved":false,"pieceType":"ROOK"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"KNIGHT"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"BISHOP"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"QUEEN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"KING"},null,{"teamColor":"LIGHT","hasMoved":false,"pieceType":"KNIGHT"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"ROOK"}],[{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},null,{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"LIGHT","hasMoved":false,"pieceType":"PAWN"}],[null,null,null,null,null,null,null,null],[null,null,{"teamColor":"LIGHT","hasMoved":true,"pieceType":"BISHOP"},null,{"teamColor":"LIGHT","hasMoved":true,"pieceType":"PAWN"},null,null,null],[null,null,null,null,null,null,null,null],[{"teamColor":"DARK","hasMoved":true,"pieceType":"PAWN"},null,null,null,null,null,null,{"teamColor":"DARK","hasMoved":true,"pieceType":"PAWN"}],[null,{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"PAWN"},null],[{"teamColor":"DARK","hasMoved":false,"pieceType":"ROOK"},{"teamColor":"DARK","hasMoved":false,"pieceType":"KNIGHT"},{"teamColor":"DARK","hasMoved":false,"pieceType":"BISHOP"},{"teamColor":"DARK","hasMoved":false,"pieceType":"QUEEN"},{"teamColor":"DARK","hasMoved":false,"pieceType":"KING"},{"teamColor":"DARK","hasMoved":false,"pieceType":"BISHOP"},{"teamColor":"DARK","hasMoved":false,"pieceType":"KNIGHT"},{"teamColor":"DARK","hasMoved":false,"pieceType":"ROOK"}]]}',
			success: function(move){
				console.log(move);
			}
		});
	}
	
	function getPieceFromLocation(location){
		return brd.boardSquares[location.getRow()][location.getCol()].getPiece();
	}
	
	function makeMove(move){
		var from = move.from;
		var to = move.to;
	}
	
	function move(from,to){
		this.from = from;
		this.to = to;
	}
	
	function makeMoveTest(move){
/* 		var from = new location(from.row,from.col);
		var to = new location(to.row, to.col); */
		var from = move.from;
		var to = move.to;
		var actualCanvas = $('#c')[0];
		var pieceOnFrom = getPieceFromLocation(from);
		var context = actualCanvas.getContext('2d');
		var img = context.createImageData(100, 100);
		for (var i = img.data.length; --i >= 0; ){
		  img.data[i] = 0;
		}
		context.putImageData(img, from.getRow(), from.getCol());
		drawPiece(pieceOnFrom.getImage(), to.getRow(), to.getCol());
	}
	
	function setGameState(gameState){
		this.movingTeamColor = gamesState.movingTeamColor;
		
	}
	

	function movePiece(from, to) {
		console.log('FROM: ' + from.getRow() + ', ' + from.getCol());
		console.log('TO: ' + to.getRow() + ', ' + to.getCol());
	}

	function buildTeam(color) {
		var mainRow = (color == "white") ? 7 : 0;
		var t = new team(color);
		setupPiece(new king(color), new location(mainRow, 4), t);
		setupPiece(new queen(color), new location(mainRow, 3), t);
		setupPiece(new bishop(color), new location(mainRow, 2), t);
		setupPiece(new bishop(color), new location(mainRow, 5), t);
		setupPiece(new knight(color), new location(mainRow, 1), t);
		setupPiece(new knight(color), new location(mainRow, 6), t);
		setupPiece(new rook(color), new location(mainRow, 0), t);
		setupPiece(new rook(color), new location(mainRow, 7), t);

		buildTeamPawns(t);
		return t;
	}

	
	
	function buildTeamPawns(team) {
		var pawnRow = (team.color == "white") ? 6 : 1;
		for ( var i = 0; i < 8; i++) {
			setupPiece(new pawn(team.color), new location(pawnRow, i), team);
		}
	}

	function setupPiece(piece, location, team) {
		team.add(piece);
		brd.placePiece(piece, location);

	}

	function piece(color) {
		this.color = color;
		this.image = null;
		this.getImage = getImage;
		this.getcolor = getColor;
		this.onclick = handleClick;
	}
	
	function handleClick(e){
		var x = Math.floor(e.pageX / CELL_SIZE);
		var y = Math.floor(e.pageY / CELL_SIZE);
		alert(x + ", " + y);
	}

	/*
	function junk(){
		console.log("hello");
	}*/

	function location(row, col) {
		this.row = row;
		this.col = col;

		this.getRow = getRow;
		this.getCol = getCol;
	}

	function getRow() {
		return this.row;
	}

	function getCol() {
		return this.col;
	}

	function getImage() {
		return this.image;
	}

	function getColor() {
		return this.color;
	}

	function team(color) {
		this.color = color;
		this.pieces = new Array();
		this.add = addPiece;
	}

	function addPiece(piece) {
		this.pieces.push(piece);
	}

	function board() {
		var x = new Array(8);
		for ( var i = 0; i < 8; i++) {
			x[i] = new Array(8);
		}
		this.boardSquares = x;
		this.initialize = initializeBoard;
		this.placePiece = placePiece;
		this.drawPieces = drawPiecesOnBoard;
	}

	function drawPiecesOnBoard() {
		for ( var i = 0; i < 8; i++) {
			for ( var j = 0; j < 8; j++) {
				var p = this.boardSquares[i][j].getPiece();
				if (p != null) {
					drawPiece(p.getImage(), i, j);
				}
			}
		}
	}

	function placePiece(piece, location) {
		this.boardSquares[location.getRow()][location.getCol()].setPiece(piece);
	}

	function initializeBoard() {
		for ( var i = 0; i < 8; i++) {
			for ( var j = 0; j < 8; j++) {
				this.boardSquares[i][j] = new boardSquare();
			}
		}
	}

	function drawBoard() {
		$('body').append('<canvas id="c">');
		var c_can = $('#c');
		c_can.attr('width', BOARD_WIDTH);
		c_can.attr('height', BOARD_HEIGHT);
		var actualCanvas = $('#c')[0];
		var context = actualCanvas.getContext('2d');
		for ( var i = 0; i <= 8; i++) {
			var x = CELL_SIZE * i + .5;
			context.moveTo(x, 0);
			context.lineTo(x, BOARD_HEIGHT);
		}

		for ( var i = 0; i <= 8; i++) {
			var y = CELL_SIZE * i + .5;
			context.moveTo(0, y);
			context.lineTo(BOARD_WIDTH, y);
		}

		for ( var i = 0; i <= 8; i++) {
			for ( var j = 0; j <= 8; j++) {
				if (i % 2 == 0) {
					if (j % 2 == 1) {
						fillCell(i, j);
					}
				} else {
					if (j % 2 == 0) {
						fillCell(i, j);
					}
				}
			}
		}
		context.strokeStyle = "#000";
		context.stroke();
		
		c_can.bind('click', handleClick);
		
	}

	function boardSquare() {
		this.piece = null;
		this.getPiece = getPiece;
		this.setPiece = setPiece;
	}

	function getPiece() {
		return this.piece;
	}

	function setPiece(piece) {
		this.piece = piece;
	}

	pawn.prototype = new piece();
	pawn.constructor = pawn;
	function pawn(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WPawn.png"
				: "images/BPawn.png";
		/*this.getImage().addEventListener("click", junk, false);*/
	}

	king.prototype = new piece();
	king.constructor = king;
	function king(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WKing.png"
				: "images/BKing.png";
	}

	rook.prototype = new piece();
	rook.constructor = rook;
	function rook(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WRook.png"
				: "images/BRook.png";
	}

	bishop.prototype = new piece();
	bishop.constructor = bishop;
	function bishop(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WBishop.png"
				: "images/BBishop.png";
	}

	knight.prototype = new piece();
	knight.constructor = knight;
	function knight(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WKnight.png"
				: "images/BKnight.png";
	}

	queen.prototype = new piece();
	queen.constructor = new queen;
	function queen(color) {
		this.image = new Image();
		this.image.src = (color == "white") ? "images/WQueen.png"
				: "images/BQueen.png";
	}

	function fillCell(row, col) {
		var x = row * CELL_SIZE + .5;
		var y = col * CELL_SIZE + .5;
		var can = $('#c')[0];
		var cntxt = can.getContext('2d');
		cntxt.fillStyle = "#58634D";
		cntxt.fillRect(x, y, CELL_SIZE, CELL_SIZE);
	}

	function drawPiece(image, row, col) {
		var x = row * CELL_SIZE + .5;
		var y = col * CELL_SIZE + .5;
		var can = $('#c')[0];
		var context = can.getContext('2d');
		image.onload = function() {
			context.drawImage(image, y, x);
		}
	}
</script>

</head>
<body>
</body>
</html>